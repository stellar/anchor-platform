version: '2.4'
services:
  platform:
    image: stellar/anchor-platform:edge
    command: --sep-server
    env_file:
      - ./config.env
      - ./config-test.env
    depends_on:
      - db
      - kafka
      - reference_server
    volumes:
      - .:/config
    ports:
      - "8080:8080" # sep-server
      - "8082:8082" # Java management server
    extra_hosts:
      - "host.docker.internal:host-gateway"

  observer:
    extends:
      file: ../common-services/common-services.yaml
      service: observer
    env_file:
      - ./config.env
      - ./config-test.env

  reference_server:
    extends:
      file: ../common-services/common-services.yaml
      service: reference_server

  kafka:
    extends:
      file: ../../common/docker-compose.yaml
      service: kafka
    depends_on:
      - zookeeper

  zookeeper:
    extends:
      file: ../../common/docker-compose.yaml
      service: zookeeper

  db:
    extends:
      file: ../../common/docker-compose.yaml
      service: db

